services:
  qdrant-service:
    image: qdrant/qdrant:v1.2.0
    container_name: qdrant_service
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage
    restart: unless-stopped

  mcp:
    build: .
    container_name: rag_mcp
    environment:
      MODEL_NAME: ${MODEL_NAME:-jinaai/jina-embeddings-v2-base-code}
      MODEL_DEVICE: ${MODEL_DEVICE:-cpu}
      QDRANT_HOST: ${QDRANT_HOST:-qdrant-service}
      QDRANT_PORT: ${QDRANT_PORT:-6333}
      CHUNK_SIZE: ${CHUNK_SIZE:-500}
      CHUNK_OVERLAP: ${CHUNK_OVERLAP:-50}
      CUDA_VISIBLE_DEVICES: ""
    depends_on:
      - qdrant-service
    # Keep stdin/stdout attached when run via `docker compose run mcp` for MCP.

volumes:
  qdrant_data:
